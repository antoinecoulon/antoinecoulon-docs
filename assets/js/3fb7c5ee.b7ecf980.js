"use strict";(self.webpackChunkantoinecoulon_docs=self.webpackChunkantoinecoulon_docs||[]).push([[3831],{6890:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>i,default:()=>p,frontMatter:()=>o,metadata:()=>a,toc:()=>d});const a=JSON.parse('{"id":"documentation/Langages/Django","title":"Django","description":"- Django","source":"@site/docs/documentation/Langages/Django.md","sourceDirName":"documentation/Langages","slug":"/documentation/Langages/Django","permalink":"/antoinecoulon-docs/docs/documentation/Langages/Django","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Base de donn\xe9es","permalink":"/antoinecoulon-docs/docs/documentation/Langages/Database"},"next":{"title":"Flutter","permalink":"/antoinecoulon-docs/docs/documentation/Langages/Flutter"}}');var r=s(4848),t=s(8453);const o={},i="Django",l={},d=[{value:"Setup a Django project",id:"setup-a-django-project",level:2},{value:"Set up a virtual environment",id:"set-up-a-virtual-environment",level:3},{value:"Install Django",id:"install-django",level:3},{value:"Pin your project dependencies",id:"pin-your-project-dependencies",level:3},{value:"Set up a Django project",id:"set-up-a-django-project",level:3},{value:"Run the server",id:"run-the-server",level:3},{value:"Setup the project database",id:"setup-the-project-database",level:3},{value:"Set up a Django app",id:"set-up-a-django-app",level:3},{value:"Register the app",id:"register-the-app",level:3},{value:"Command Reference",id:"command-reference",level:3},{value:"Create a view to serve content",id:"create-a-view-to-serve-content",level:2},{value:"Models",id:"models",level:2},{value:"Example (Model)",id:"example-model",level:3},{value:"Migrations",id:"migrations",level:3},{value:"Update the view with the new data object",id:"update-the-view-with-the-new-data-object",level:2},{value:"Gabarit",id:"gabarit",level:2}];function c(e){const n={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"django",children:"Django"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"#django",children:"Django"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"#setup-a-django-project",children:"Setup a Django project"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#set-up-a-virtual-environment",children:"Set up a virtual environment"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#install-django",children:"Install Django"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#pin-your-project-dependencies",children:"Pin your project dependencies"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#set-up-a-django-project",children:"Set up a Django project"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#run-the-server",children:"Run the server"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#setup-the-project-database",children:"Setup the project database"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#set-up-a-django-app",children:"Set up a Django app"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#register-the-app",children:"Register the app"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#command-reference",children:"Command Reference"})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#create-a-view-to-serve-content",children:"Create a view to serve content"})}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"#models",children:"Models"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#example-model",children:"Example (Model)"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#migrations",children:"Migrations"})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#update-the-view-with-the-new-data-object",children:"Update the view with the new data object"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#gabarit",children:"Gabarit"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.p,{children:"Docs:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://docs.djangoproject.com/",children:"Documentation officielle"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://realpython.com/django-setup/",children:"Django Setup"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://openclassrooms.com/fr/courses/7172076-debutez-avec-le-framework-django",children:"Cours OpenClassrooms"})}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"setup-a-django-project",children:"Setup a Django project"}),"\n",(0,r.jsx)(n.p,{children:"Cr\xe9er un repository pour l'ensemble du projet, se placer \xe0 l'int\xe9rieur et initialiser le d\xe9p\xf4t Git si besoin:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"mkdir django-web-app\ncd django-web-app/\ngit init\n"})}),"\n",(0,r.jsx)(n.h3,{id:"set-up-a-virtual-environment",children:"Set up a virtual environment"}),"\n",(0,r.jsx)(n.p,{children:"Cr\xe9er un environnement virtuel avec python3 (permet de garder les packages de notre projet isol\xe9s des autres projets):"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"~/django-web-app\n\u2192 python --version\nPython 3.9.2\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"python3 -m venv env\n"})}),"\n",(0,r.jsxs)(n.p,{children:["(Ajouter ",(0,r.jsx)(n.code,{children:"env/"})," au fichier ",(0,r.jsx)(n.code,{children:".gitignore"})," !)"]}),"\n",(0,r.jsx)(n.p,{children:"Puis activer cet environnement virtuel:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"~/django-web-app\n\u2192 source env/bin/activate\n(env) ~/django-web-app \n# Le (env) indique que l'environnement est bien activ\xe9\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Important !"})," Vous devez toujours avoir votre environnement virtuel activ\xe9 pendant le d\xe9veloppement. Si vous red\xe9marrez votre machine ou que vous importer votre projet depuis une autre machine, reproduisez l'\xe9tape ci-dessus."]}),"\n",(0,r.jsxs)(n.p,{children:["Voir +: ",(0,r.jsx)(n.a,{href:"https://realpython.com/python-virtual-environments-a-primer/",children:"how to work with virtual environments in Python"}),", et ",(0,r.jsx)(n.a,{href:"https://realpython.com/learning-paths/perfect-your-python-development-setup/",children:"how to perfect your Python development setup"})]}),"\n",(0,r.jsx)(n.h3,{id:"install-django",children:"Install Django"}),"\n",(0,r.jsxs)(n.p,{children:["Installer Django avec ",(0,r.jsx)(n.code,{children:"pip"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"(env) ~/django-web-app\n\n\u2192 pip install django\n...\nSuccessfully installed django-3.1.7\n"})}),"\n",(0,r.jsx)(n.p,{children:"Le package Django est install\xe9, ainsi qu'un certain nombre de d\xe9pendances : des packages dont Django a besoin pour fonctionner."}),"\n",(0,r.jsx)(n.p,{children:"Gardons la trace de tous ces packages dans un fichier requirements.txt."}),"\n",(0,r.jsx)(n.h3,{id:"pin-your-project-dependencies",children:"Pin your project dependencies"}),"\n",(0,r.jsx)(n.p,{children:"Pour conserver la liste des d\xe9pendances n\xe9cessaires et pouvoir les r\xe9installer facilement:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"(env) pip freeze > requirements.txt\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ini",children:"# ~/django-web-app/requirements.txt\n\nasgiref==3.3.1\nDjango==3.1.7\nsqlparse==0.4.1\n"})}),"\n",(0,r.jsx)(n.p,{children:"Si besoin de charger/r\xe9installer toutes les d\xe9pendances n\xe9cessaires:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"(env) pip install -r requirements.txt\n"})}),"\n",(0,r.jsx)(n.h3,{id:"set-up-a-django-project",children:"Set up a Django project"}),"\n",(0,r.jsx)(n.p,{children:"Nous allons g\xe9n\xe9rer automatiquement notre code de base Django."}),"\n",(0,r.jsx)(n.p,{children:"Le code de base est un code gabarit ou code de d\xe9marrage : c'est le code de base dont nous avons besoin pour un projet Django fonctionnel, mais vide."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"(env) ~/django-web-app\n\u2192 django-admin startproject <project_name>\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Nous avons g\xe9n\xe9r\xe9 notre code de base en lan\xe7ant la commande ",(0,r.jsx)(n.code,{children:"django-admin"})," , suivie de la sous-commande ",(0,r.jsx)(n.code,{children:"startproject"})," et en passant comme argument le nom \xe0 utiliser pour le projet (",(0,r.jsx)(n.code,{children:"project_name"}),")."]}),"\n",(0,r.jsx)(n.p,{children:"C'est ce nom qui est utilis\xe9 pour le r\xe9pertoire de premier niveau."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-markdown",children:"project_name/\n\u2502\n\u251c\u2500\u2500 project_name/\n\u2502   \u251c\u2500\u2500 __init__.py\n\u2502   \u251c\u2500\u2500 asgi.py\n\u2502   \u251c\u2500\u2500 settings.py\n\u2502   \u251c\u2500\u2500 urls.py\n\u2502   \u2514\u2500\u2500 wsgi.py\n\u2502\n\u2514\u2500\u2500 manage.py\n"})}),"\n",(0,r.jsxs)(n.p,{children:["\xc0 l'int\xe9rieur, nous avons un autre r\xe9pertoire avec le m\xeame nom, dont nous parlerons plus tard dans ce chapitre. Nous avons \xe9galement un script Python appel\xe9 ",(0,r.jsx)(n.code,{children:"manage.py"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["Maintenant, lorsque nous utiliserons l'utilitaire de ligne de commande de Django, nous l'appellerons via ",(0,r.jsx)(n.code,{children:"manage.py"})," au lieu de ",(0,r.jsx)(n.code,{children:"django-admin"})," comme nous le faisions auparavant. En fait, ",(0,r.jsx)(n.code,{children:"manage.py"})," est con\xe7u pour fonctionner sp\xe9cifiquement avec notre projet, alors que ",(0,r.jsx)(n.code,{children:"django-admin"})," est une version plus g\xe9n\xe9rique de l'utilitaire."]}),"\n",(0,r.jsx)(n.p,{children:"Avec le code de base en place, nous avons tout ce dont nous avons besoin pour lancer notre site pour la premi\xe8re fois."}),"\n",(0,r.jsx)(n.h3,{id:"run-the-server",children:"Run the server"}),"\n",(0,r.jsxs)(n.p,{children:["Appelons \xe0 nouveau l'utilitaire de ligne de commande, cette fois via ",(0,r.jsx)(n.code,{children:"manage.py"}),", et lan\xe7ons la sous-commande ",(0,r.jsx)(n.code,{children:"runserver"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["Le fichier ",(0,r.jsx)(n.code,{children:"manage.py"})," est un script Python ; nous allons donc ajouter le pr\xe9fixe ",(0,r.jsx)(n.code,{children:"python3"})," \xe0 chaque fois que nous l'ex\xe9cuterons, par exemple: ",(0,r.jsx)(n.code,{children:"python3 manage.py runserver"}),"."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"(env) ~/django-web-app/project_name\n\u2192 python3 manage.py runserver\nWatching for file changes with StatReloader\nPerforming system checks...\n\nSystem check identified no issues (0 silenced).\n\nYou have 18 unapplied migration(s). Your project may not work properly until you apply the migrations for app(s): admin, auth, contenttypes, sessions.\nRun 'python manage.py migrate' to apply them.\nFebruary 07, 2021 - 17:58:59\nDjango version 3.1.6, using settings 'merchex.settings'\nStarting development server at http://127.0.0.1:8000/\nQuit the server with CONTROL-C.\n"})}),"\n",(0,r.jsxs)(n.p,{children:["L'utilitaire nous indique que le serveur de d\xe9veloppement a d\xe9marr\xe9 \xe0 l'adresse ",(0,r.jsx)(n.code,{children:"http://127.0.0.1:8000/"}),"."]}),"\n",(0,r.jsx)(n.h3,{id:"setup-the-project-database",children:"Setup the project database"}),"\n",(0,r.jsx)(n.p,{children:"Nous avions ce message:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"You have 18 unapplied migration(s). Your project may not work properly until you apply the migrations for app(s): admin, auth, contenttypes, sessions.\nRun 'python manage.py migrate' to apply them.\n"})}),"\n",(0,r.jsx)(n.p,{children:"Les migrations repr\xe9sentent un moyen de configurer la base de donn\xe9es de notre application."}),"\n",(0,r.jsx)(n.p,{children:"Utilisons maintenant l'utilitaire de ligne de commande pour cr\xe9er notre base de donn\xe9es."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"^C\n(env) ~/django-web-app/project_name\n\u2192 python3 manage.py migrate\nOperations to perform:\nApply all migrations: admin, auth, contenttypes, sessions\nRunning migrations:\nApplying ...\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Un fichier de base de donn\xe9es a \xe9t\xe9 cr\xe9\xe9, appel\xe9 ",(0,r.jsx)(n.code,{children:"db.sqlite3"})," ! Il s'agit de la base de donn\xe9es qui contiendra toutes les donn\xe9es de notre application, c\u2019est donc une bonne chose de l\u2019avoir cr\xe9\xe9e d\xe8s maintenant."]}),"\n",(0,r.jsxs)(n.p,{children:["Ajouter ce fichier ",(0,r.jsx)(n.code,{children:"db.sqlite3"})," au gitignore !"]}),"\n",(0,r.jsx)(n.h3,{id:"set-up-a-django-app",children:"Set up a Django app"}),"\n",(0,r.jsx)(n.p,{children:"Ensuite, nous allons cr\xe9er ce que Django appelle une \xab application \xbb."}),"\n",(0,r.jsx)(n.p,{children:"Dans Django, une application est une sous-section de votre projet entier. Django nous encourage \xe0 compartimenter notre projet entier Django en applications, pour deux raisons principales :"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"cela permet de garder notre projet organis\xe9 et g\xe9rable au fur et \xe0 mesure qu'il se d\xe9veloppe."}),"\n",(0,r.jsx)(n.li,{children:"cela signifie qu'une application peut \xe9ventuellement \xeatre r\xe9utilis\xe9e dans plusieurs projets."}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Cr\xe9er cette application en utilisant la sous-commande ",(0,r.jsx)(n.code,{children:"startapp"})," dans l'utilitaire de ligne de commande :"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"(env) $ python3 manage.py startapp <appname>\n"})}),"\n",(0,r.jsx)(n.p,{children:"Chaque r\xe9pertoire d'applications est sp\xe9cifique \xe0 une application. Mais votre r\xe9pertoire de projet contient des fichiers de configuration pour l'ensemble du projet : c'est un peu la \xab tour de contr\xf4le \xbb de votre projet Django."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-markdown",children:"project_name/\n\u2502\n\u251c\u2500\u2500 appname/\n\u2502   \u2502\n\u2502   \u251c\u2500\u2500 migrations/\n\u2502   \u2502   \u2514\u2500\u2500 __init__.py\n\u2502   \u2502\n\u2502   \u251c\u2500\u2500 __init__.py\n\u2502   \u251c\u2500\u2500 admin.py\n\u2502   \u251c\u2500\u2500 apps.py\n\u2502   \u251c\u2500\u2500 models.py\n\u2502   \u251c\u2500\u2500 tests.py\n\u2502   \u2514\u2500\u2500 views.py\n\u2502\n\u251c\u2500\u2500 project_name/\n\u2502   \u251c\u2500\u2500 __init__.py\n\u2502   \u251c\u2500\u2500 asgi.py\n\u2502   \u251c\u2500\u2500 settings.py\n\u2502   \u251c\u2500\u2500 urls.py\n\u2502   \u2514\u2500\u2500 wsgi.py\n\u2502\n\u2514\u2500\u2500 manage.py\n"})}),"\n",(0,r.jsx)(n.h3,{id:"register-the-app",children:"Register the app"}),"\n",(0,r.jsx)(n.p,{children:"La derni\xe8re \xe9tape consiste \xe0 \xab installer \xbb l'application dans le projet."}),"\n",(0,r.jsxs)(n.p,{children:["Lorsque nous avons g\xe9n\xe9r\xe9 le code de base de notre projet, l'un des fichiers cr\xe9\xe9s s'appelait settings.py. Ouvrez maintenant ce fichier et trouvez une liste Python appel\xe9e INSTALLED_APPS. En bas de cette liste, ajoutez la cha\xeene de caract\xe8res ",(0,r.jsx)(n.code,{children:"<appname>"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"INSTALLED_APPS = [\n    'django.contrib.admin',\n    'django.contrib.auth',\n    'django.contrib.contenttypes',\n    'django.contrib.sessions',\n    'django.contrib.messages',\n    'django.contrib.staticfiles',\n    'appname',  # <- Here\n]\n\n"})}),"\n",(0,r.jsx)(n.p,{children:"Par d\xe9faut, le code de base de Django comprend l'installation d'un certain nombre d'applications utiles, que la plupart des projets utiliseront probablement \xe0 un moment ou \xe0 un autre."}),"\n",(0,r.jsx)(n.p,{children:"Contrairement \xe0 notre application, ces applications suppl\xe9mentaires ne se trouvent pas dans notre code source, nous ne voyons pas leur r\xe9pertoire dans notre code. Ces applications sont, en fait, import\xe9es depuis le package de Django que nous avons install\xe9 au d\xe9but de ce chapitre avec pip."}),"\n",(0,r.jsx)(n.p,{children:"La meilleure pratique consiste \xe0 ajouter notre application en bas de la liste afin qu'elle soit la derni\xe8re \xe0 se charger."}),"\n",(0,r.jsx)(n.h3,{id:"command-reference",children:"Command Reference"}),"\n",(0,r.jsxs)(n.p,{children:["1a: Set up a virtual environment: ",(0,r.jsx)(n.code,{children:"python -m venv env"}),"\n1b: Activate the virtual environment: ",(0,r.jsx)(n.code,{children:"source env/bin/activate"}),"\n2a: Install Django: ",(0,r.jsx)(n.code,{children:"python -m pip install django"}),"\n2b: Pin your dependencies: ",(0,r.jsx)(n.code,{children:"python -m pip freeze > requirements.txt"}),"\n3: Set up a Django project: ",(0,r.jsx)(n.code,{children:"django-admin startproject <projectname>"}),"\n4: Start a Django app: ",(0,r.jsx)(n.code,{children:"python manage.py startapp <appname>"})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"create-a-view-to-serve-content",children:"Create a view to serve content"}),"\n",(0,r.jsx)(n.p,{children:"Nous allons cr\xe9er une premi\xe8re page sur notre site, tr\xe8s basique, certes, mais ce sera tout de m\xeame une page ! Commen\xe7ons par ouvrir le fichier appname/views.py. Pour l'instant, cela ressemble \xe0 ceci :"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"from django.shortcuts import render\n\n# Create your views here.\n"})}),"\n",(0,r.jsx)(n.p,{children:"Supprimons le commentaire et rempla\xe7ons-le par une simple fonction. Nous allons \xe9galement ajouter une d\xe9claration d'import suppl\xe9mentaire en haut :"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"from django.http import HttpResponse\nfrom django.shortcuts import render\n\ndef hello(request):\n    return HttpResponse('<h1>Hello Django!</h1>')\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Nous venons de cr\xe9er une vue, l'un des blocs constitutifs de l'",(0,r.jsx)(n.strong,{children:"architecture MVT"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["Une vue a pour fonction de r\xe9pondre \xe0 la visite d'un utilisateur sur le site en renvoyant une page que l\u2019utilisateur peut voir. En Python, une vue est une fonction qui accepte un objet ",(0,r.jsx)(n.code,{children:"HttpRequest"})," comme param\xe8tre et retourne un objet ",(0,r.jsx)(n.code,{children:"HttpResponse"}),"."]}),"\n",(0,r.jsx)(n.p,{children:"Dans notre exemple de vue, nous renvoyons une r\xe9ponse HTTP avec un contenu HTML simple : un titre H1 disant \xab Hello Django ! \xbb."}),"\n",(0,r.jsx)(n.p,{children:"Ouvrons donc le fichier appname/urls.py. Actuellement, le code (sans les commentaires) ressemble \xe0 ceci :"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"from django.contrib import admin\nfrom django.urls import path\n\nurlpatterns = [\npath('admin/', admin.site.urls),\n]\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Importons le module views que nous avons \xe9dit\xe9 \xe0 l'\xe9tape pr\xe9c\xe9dente, en ajoutant une d\xe9claration d'import. Puis nous ajouterons un nouvel \xe9l\xe9ment \xe0 la liste ",(0,r.jsx)(n.code,{children:"urlpatterns"}),", o\xf9 nous ferons r\xe9f\xe9rence \xe0 la fonction vue que nous venons de cr\xe9er."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"from django.contrib import admin\nfrom django.urls import path\nfrom appname import views\n\nurlpatterns = [\npath('admin/', admin.site.urls),\npath('hello/', views.hello)\n]\n"})}),"\n",(0,r.jsx)(n.p,{children:"Nous venons de cr\xe9er un mod\xe8le d'URL et de le lier \xe0 notre vue. Un mod\xe8le d'URL, c\u2019est la fa\xe7on dont nous indiquons \xe0 Django qu'il doit \xeatre \xe0 l'\xe9coute d'une requ\xeate pour une URL donn\xe9e, puis appeler une vue sp\xe9cifique pour g\xe9n\xe9rer une page."}),"\n",(0,r.jsxs)(n.p,{children:["Maintenant, chaque fois que quelqu'un visite l'URL ",(0,r.jsx)(n.code,{children:"hello/"})," sur notre site, la vue ",(0,r.jsx)(n.code,{children:"hello"})," va g\xe9n\xe9rer une page pour nous qui sera disponible \xe0 l'URL ",(0,r.jsx)(n.code,{children:"http://127.0.0.1:8000/hello/"}),"."]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"models",children:"Models"}),"\n",(0,r.jsxs)(n.p,{children:["Pour chaque entit\xe9 pour laquelle nous voulons stocker des donn\xe9es, nous cr\xe9ons un mod\xe8le pour repr\xe9senter cette entit\xe9. Un ",(0,r.jsx)(n.strong,{children:"mod\xe8le"})," d\xe9finit les caract\xe9ristiques que nous voulons stocker \xe0 propos d'une entit\xe9 particuli\xe8re. Ces caract\xe9ristiques sont \xe9galement connues sous le nom de ",(0,r.jsx)(n.strong,{children:"champs"}),". Nous pouvons ensuite utiliser le mod\xe8le pour cr\xe9er des objets individuels, ou instances, de ce mod\xe8le, qui ont chacun leurs propres caract\xe9ristiques uniques."]}),"\n",(0,r.jsxs)(n.p,{children:['Un mod\xe8le est \xe9galement capable de stocker (ou de "',(0,r.jsx)(n.em,{children:"persister"}),'") ses donn\xe9es dans une base de donn\xe9es pour une utilisation ult\xe9rieure. Dans Django, toutes les fonctionnalit\xe9s de persistance des donn\xe9es dans une base de donn\xe9es ont d\xe9j\xe0 \xe9t\xe9 \xe9crites pour vous. Tout ce que vous avez \xe0 faire est de faire en sorte que votre mod\xe8le h\xe9rite de la classe ',(0,r.jsx)(n.code,{children:"models.Model"})," de Django. Votre mod\xe8le h\xe9rite ensuite de toutes les m\xe9thodes (comportements) n\xe9cessaires pour effectuer des op\xe9rations telles que la s\xe9lection et l'insertion de donn\xe9es dans une base de donn\xe9es."]}),"\n",(0,r.jsx)(n.h3,{id:"example-model",children:"Example (Model)"}),"\n",(0,r.jsxs)(n.p,{children:["Ouvrez le fichier ",(0,r.jsx)(n.code,{children:"models.py"})," qui ressemble \xe0 ceci :"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"from django.db import models\n\n# Create your models here.\n"})}),"\n",(0,r.jsx)(n.p,{children:"Une fois encore, Django nous a laiss\xe9 un commentaire utile (Create your models here). Maintenant que nous savons o\xf9 vont nos mod\xe8les, rempla\xe7ons ce commentaire par le code suivant :"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"class Example(models.Model):\n    name = models.fields.CharField(max_length=100)\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Nous avons d\xe9fini notre classe, l'avons nomm\xe9e Example et l'avons fait h\xe9riter de ",(0,r.jsx)(n.code,{children:"models.Model"}),", qui est la classe de base du mod\xe8le de Django."]}),"\n",(0,r.jsxs)(n.p,{children:["Ensuite, nous ajoutons un attribut de classe \xe0 notre classe: ",(0,r.jsx)(n.code,{children:"name"}),". \xc0 cet attribut, nous attribuons un ",(0,r.jsx)(n.code,{children:"CharField"}),", qui est l'abr\xe9viation de Character Field. Il s'agira d'un champ qui stocke des donn\xe9es de type caract\xe8re/texte/cha\xeene, ce qui est le type de donn\xe9es appropri\xe9 pour un nom. Nous avons \xe9galement fix\xe9 la longueur maximale du nom \xe0 100."]}),"\n",(0,r.jsx)(n.p,{children:"Et voil\xe0 notre premier mod\xe8le."}),"\n",(0,r.jsx)(n.p,{children:"Comme pour les classes Python, nous pouvons utiliser les mod\xe8les Django pour cr\xe9er des instances de cette classe, par exemple example = Example()."}),"\n",(0,r.jsx)(n.p,{children:"Comme nous l'avons dit, une des caract\xe9ristiques d'un mod\xe8le est qu'il est capable de stocker ses donn\xe9es dans une base de donn\xe9es. Nous avons cr\xe9\xe9 notre base de donn\xe9es dans le chapitre sur la configuration. Mais cette base de donn\xe9es ne sait encore rien de notre mod\xe8le de donn\xe9es (Example). Et c'est l\xe0 que les migrations entrent en jeu."}),"\n",(0,r.jsx)(n.h3,{id:"migrations",children:"Migrations"}),"\n",(0,r.jsxs)(n.p,{children:["Si nous voulons stocker les groupes dans notre base de donn\xe9es, nous aurons besoin d'une nouvelle table, contenant une colonne pour chaque champ que nous avons ajout\xe9 \xe0 notre mod\xe8le, ainsi qu'une colonne ",(0,r.jsx)(n.code,{children:"id"})," pour servir de cl\xe9 primaire : un identifiant unique pour chaque ligne de la table."]}),"\n",(0,r.jsx)(n.p,{children:"La structure d'une base de donn\xe9es, en termes de tables et de colonnes, est appel\xe9e sch\xe9ma."}),"\n",(0,r.jsxs)(n.p,{children:["Dans Django, nous utilisons une sous-commande de l'utilitaire de ligne de commande qui va g\xe9n\xe9rer des instructions pour construire la table. Et ensuite, nous utilisons une autre sous-commande pour ex\xe9cuter ces instructions. Ces instructions sont appel\xe9es une ",(0,r.jsx)(n.strong,{children:"migration"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["Une ",(0,r.jsx)(n.strong,{children:"migration"})," est un ensemble d'instructions permettant de passer le ",(0,r.jsx)(n.em,{children:"sch\xe9ma"})," de votre base de donn\xe9es d'un \xe9tat \xe0 un autre. Il est important de noter que ces instructions peuvent \xeatre ex\xe9cut\xe9es automatiquement, comme un code."]}),"\n",(0,r.jsx)(n.p,{children:"Cr\xe9er une migration pour notre mod\xe8le:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"(env) ~/django-web-app/appname\n\u2192 python manage.py makemigrations\npython manage.py makemigrations\nMigrations for 'appname':\n  appname/migrations/0001_initial.py\n    - Create model Example\n"})}),"\n",(0,r.jsx)(n.p,{children:"Le r\xe9sultat de la CLI nous indique qu'une nouvelle migration a \xe9t\xe9 enregistr\xe9e dans \xab appname/migrations/0001_initial.py \xbb, et que son objectif est de \xab Cr\xe9er le mod\xe8le Example \xbb, ce qui signifie en fait que cette migration va cr\xe9er une table dans la base de donn\xe9es pour notre mod\xe8le Example."}),"\n",(0,r.jsxs)(n.p,{children:["L'avantage de cette commande est qu'elle analyse notre fichier ",(0,r.jsx)(n.code,{children:"models.py"})," pour y d\xe9celer toute modification et d\xe9terminer le type de migration \xe0 g\xe9n\xe9rer."]}),"\n",(0,r.jsx)(n.p,{children:"Maintenant que nous avons notre migration (nos instructions), nous devons ex\xe9cuter ces instructions sur la base de donn\xe9es."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"(env) ~/django-web-app/appname\n\u2192 python manage.py migrate\nOperations to perform:\nApply all migrations: admin, appname, auth, contenttypes, sessions\nRunning migrations:\nApplying appname.0001_initial... OK\n"})}),"\n",(0,r.jsx)(n.p,{children:"Django a recherch\xe9 dans chacune de ces applications install\xe9es de nouvelles migrations \xe0 ex\xe9cuter, il a trouv\xe9 notre nouvelle migration et l'a \xab appliqu\xe9e \xbb : il a ex\xe9cut\xe9 ces instructions sur la base de donn\xe9es."}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"update-the-view-with-the-new-data-object",children:"Update the view with the new data object"}),"\n",(0,r.jsx)(n.p,{children:"(pour l'exemple, nous avons cr\xe9\xe9 des instance de notre mod\xe8le directement dans le shell Django et les avons sauvegard\xe9 en BDD...)"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",metastring:'title="appname/views.py"',children:'...\nfrom appname.models import Example\n...\n\ndef hello(request):\n    examples = Example.objects.all()\n    return HttpResponse(f"""\n        <h1>Hello from Django !</h1>\n        <ul>\n            <li>{examples[0].name}</li>\n            <li>{examples[1].name}</li>\n            <li>{examples[2].name}</li>\n        </ul>\n""")\n'})}),"\n",(0,r.jsxs)(n.p,{children:["La variable ",(0,r.jsx)(n.code,{children:"examples"})," contient maintenant une liste de toutes les instances que nous avons cr\xe9\xe9 dans le shell et qui sont dans la base de donn\xe9es. Cela signifie qu'il est maintenant possible d'acc\xe9der \xe0 chacun des objets Example individuels en utilisant la notation d'index de Python. Ensuite, pour acc\xe9der au champ \xab name \xbb de l'un de ces objets Example, nous ferons appel \xe0 l'attribut name de l'objet en utilisant la notation par points de Python."]}),"\n",(0,r.jsxs)(n.p,{children:["D\xe9finir nos vues de cette fa\xe7on, c'est \xe0 dire en codant notre page HTML directement dans notre liste de vues, est une mauvaise pratique (anti-pattern). Le probl\xe8me est que notre vue a maintenant deux responsabilit\xe9s : la ",(0,r.jsx)(n.em,{children:"logique"})," et la ",(0,r.jsx)(n.em,{children:"pr\xe9sentation"}),". En continuant de cette fa\xe7on, notre application pourrait vite devenir ing\xe9rable."]}),"\n",(0,r.jsxs)(n.p,{children:["Nous allons adh\xe9rer au principe de la responsabilit\xe9 unique en d\xe9pla\xe7ant la responsabilit\xe9 de la pr\xe9sentation hors de la vue et en la pla\xe7ant \xe0 sa place l\xe9gitime : un ",(0,r.jsx)(n.strong,{children:"gabarit"}),"."]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"gabarit",children:"Gabarit"}),"\n",(0,r.jsxs)(n.p,{children:["Commencez par cr\xe9er un nouveau fichier \xe0 l'adresse : ",(0,r.jsx)(n.code,{children:"appname/templates/appname/hello.html"})]}),"\n",(0,r.jsxs)(n.p,{children:["Notez la structure de r\xe9pertoire que nous utilisons ici. Nous mettons toujours un sous-r\xe9pertoire dans le r\xe9pertoire des gabarits (templates) qui porte le m\xeame nom que l'application. D\xe9couvrez quelques ",(0,r.jsx)(n.a,{href:"http://www.formation-django.fr/framework-django/vues-templates/",children:"astuces sur l'utilisation des gabarits"}),"."]}),"\n",(0,r.jsx)(n.p,{children:"Remplissons ce fichier avec notre HTML :"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-html",children:"<html>\n    <head><title>Appname</title></head>\n    <body>\n        <h1>Hello from Django !</h1>\n        ...\n    </body>\n</html>\n"})}),"\n",(0,r.jsx)(n.p,{children:"Mettons maintenant \xe0 jour notre vue, de sorte qu'au lieu de d\xe9finir son propre HTML, elle g\xe9n\xe8re notre mod\xe8le \xe0 la place :"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"...\nfrom django.shortcuts import render\n...\n\ndef hello(request):\n    examples = Example.objects.all()\n    return render(request, 'appname/hello.html')\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Tout d'abord, nous importons la fonction ",(0,r.jsx)(n.code,{children:"render"}),". Cet \xe9l\xe9ment est probablement d\xe9j\xe0 pr\xe9sent puisqu'il est inclus dans le code de base, mais ajoutez-le si n\xe9cessaire."]}),"\n",(0,r.jsxs)(n.p,{children:["Dans la d\xe9claration de retour, nous n'appelons plus le constructeur ",(0,r.jsx)(n.code,{children:"HttpResponse"}),". Au lieu de cela, nous appelons la fonction ",(0,r.jsx)(n.code,{children:"render"})," avec 2 arguments :"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"l'objet request qui est pass\xe9 dans la fonction hello"}),"\n",(0,r.jsx)(n.li,{children:"une cha\xeene de caract\xe8res contenant le chemin d'acc\xe8s au fichier gabarit que nous avons cr\xe9\xe9"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Sous le capot, la fonction ",(0,r.jsx)(n.code,{children:"render"})," cr\xe9e un objet ",(0,r.jsx)(n.code,{children:"HttpResponse"})," avec le HTML de notre mod\xe8le et le renvoie. Notre vue renvoie donc toujours une ",(0,r.jsx)(n.code,{children:"HttpResponse"})," (ce qu'elle doit faire, pour \xeatre une vue)."]}),"\n",(0,r.jsxs)(n.p,{children:["Revenons \xe0 notre vue et ajoutons un troisi\xe8me argument \xe0 notre appel de la m\xe9thode render. Cet argument doit \xeatre un ",(0,r.jsx)(n.code,{children:"dict"})," Python."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"...\nreturn render(request, 'appname/hello.html',\n        {'first_example': examples[0]})\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Ce dictionnaire est appel\xe9 ",(0,r.jsx)(n.strong,{children:"dictionnaire contextuel"}),". Chaque cl\xe9 du dictionnaire devient une variable que nous pouvons utiliser dans notre mod\xe8le, comme ceci :"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"# listings/templates/listings/hello.html\n\n...\n    <ul>\n        <li>{{ first_example.name }}</li>\n    </ul>\n...\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Les gabarits de Django peuvent inclure cette syntaxe avec des accolades, \xe9galement connue sous le nom de ",(0,r.jsx)(n.strong,{children:"langage de gabarits"})," Django. Chaque fois que vous voyez des doubles accolades contenant un nom de variable, la valeur de cette variable sera ins\xe9r\xe9e. Elles sont appel\xe9es ",(0,r.jsx)(n.strong,{children:"variables de gabarits"}),"."]}),"\n",(0,r.jsx)(n.p,{children:"Nous pourrions continuer \xe0 ajouter chaque groupe individuellement au dictionnaire contextuel, mais gagnons du temps et passons-les tous en une seule fois :"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"    ...\n    return render(request,\n    'appname/hello.html',\n    {'examples': examples})\n"})}),"\n",(0,r.jsx)(n.p,{children:"Puis, dans notre mod\xe8le :"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-html",children:"...\n    <ul>\n        <li>{{ examples.0.name }}</li>\n        <li>{{ examples.1.name }}</li>\n        <li>{{ examples.2.name }}</li>\n    </ul>\n...\n"})}),"\n",(0,r.jsx)(n.p,{children:"Avec une boucle pour g\xe9rer les ajouts/retraits:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-html",children:"<ul>\n    {% for example in examples %}\n    <li>{{ example.name }}</li>\n    {% endfor %}\n</ul>\n\n\x3c!-- Exemple de FILTRE : --\x3e\n<p>Il y a {{ examples|length }} exemples diff\xe9rents !</p>\n\n \x3c!-- Exemple d'instruction if...elif...else --\x3e\n<p>\n    J'ai..\n    {% if examples|length < 5 %}\n        peu de\n    {% elif example|length < 10 %}\n        quelques\n    {% else %}\n        beaucoup de\n    {% endif %}\n    exemples.\n</p>\n \n"})})]})}function p(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>i});var a=s(6540);const r={},t=a.createContext(r);function o(e){const n=a.useContext(t);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),a.createElement(t.Provider,{value:n},e.children)}}}]);